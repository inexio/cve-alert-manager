FROM golang:1.13.7-alpine3.10 AS builder

WORKDIR /build

# enables caching of modules as a Docker layer
COPY go.mod .
COPY go.sum .
RUN set -eu -o pipefail
RUN go mod download

# copy the rest of the directory to
COPY . .

# build the program
RUN GO111MODULE=on CGO_ENABLED=0 go build -a -o ./out/app ./cve-alert-fetcher

################
# run program
################

FROM alpine:3.10

COPY --from=builder /build/out/app .

ENTRYPOINT ["./app", "--init-db"]
